<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Check GO term annotation strategies and evaluate within scDiffCom.
">
<title>scDiffCom: GO Annotation • scDiffCom</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="scDiffCom: GO Annotation">
<meta property="og:description" content="Check GO term annotation strategies and evaluate within scDiffCom.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scDiffCom</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="scDiffCom-GO-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>scDiffCom: GO Annotation</h1>
                        <h4 data-toc-skip class="author">Cyril Lagger, Eugen Ursu</h4>
            
      
      
      <div class="d-none name"><code>scDiffCom-GO-vignette.Rmd</code></div>
    </div>

    
    
<p>The objectives of this vignette are:</p>
<ol style="list-style-type: decimal">
<li>Show some of the details on how the GO Term annotation takes place in <code>scDiffCom</code>.</li>
<li>Investigate the properties of GO Term merging modes.</li>
</ol>
<p>Let’s start by presenting the relevant data structures used within <code>scDiffCom</code>.</p>
<div class="section level2">
<h2 id="go-terms-data-structures-in-scdiffcom">GO Terms data structures in <code>scDiffCom</code><a class="anchor" aria-label="anchor" href="#go-terms-data-structures-in-scdiffcom"></a>
</h2>
<p>First, there is the gene ontology <code>data.table</code> that describes the location of each GO term in the GO ontology graph. In particular, note the integer column <code>LEVEL</code> that is a proxy for the distance to the GO term in the GO ontology graph from the “roots” (biological process, molecular function, cellular component).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">easyGgplot2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cyrillagger.github.io/scDiffCom/">scDiffCom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gene_ontology_level</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gene_ontology_level</span><span class="op">)</span></span></code></pre></div>
<p>Second, there is another <code>data.table</code> that connects LRIs to GO terms. For example, for mice, there are two ways of accessing it:</p>
<ol style="list-style-type: decimal">
<li>Compute</li>
<li>Precomputed - internal <code>scDiffCom</code> data: <code>scDiffCom::LRI_mouse$LRI_curated_GO</code>, computed with (1)</li>
</ol>
<p>So internally, <code>get_GO_interactions</code> performs the assignment of GO Terms to LRI. We allow for several modes of merging the GO terms for the ligands and receptors into a set of GO terms associated with a LRI. Below we compute the <code>LRI_curated_GO</code> for each such mode. In what follows, we will compare them.</p>
<p>Let’s see how different are the assignments of GO Terms to LRI as a function of merging modes. Firstly, we check the distribution across LRI of the maximum level of the assigned GO Terms. In other words, for each LRI, we extract the levels of each of the assigned GO Terms and take the maximum over this set.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots_max</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plots_median</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">LRI_curated_GO_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">GO</span> <span class="op">=</span> <span class="va">LRI_curated_GO_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">merge_mode</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">LRI_curated_GO_list</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">GO</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">GO</span>, <span class="va">gene_ontology_level</span>, by.x<span class="op">=</span><span class="st">"GO_ID"</span>, by.y<span class="op">=</span><span class="st">"ID"</span>, all.x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">GO</span> <span class="op">=</span> <span class="va">GO</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">GO</span><span class="op">$</span><span class="va">LEVEL</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">GO_max_level</span> <span class="op">=</span> <span class="va">GO</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">LEVEL</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"LRI"</span><span class="op">]</span></span>
<span>  <span class="va">plot_max</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">GO_max_level</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">max_level</span><span class="op">)</span><span class="op">)</span> </span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span></span>
<span>       <span class="co"># + scale_x_continuous(breaks = 1:18)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1200</span><span class="op">)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{merge_mode}\nNum GO:LRI={nrow(GO)}\nN={nrow(GO_max_level)}\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">plots_max</span><span class="op">[[</span><span class="va">merge_mode</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">plot_max</span></span>
<span>  </span>
<span>  <span class="va">GO_median_level</span> <span class="op">=</span> <span class="va">GO</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>median_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">LEVEL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"LRI"</span><span class="op">]</span></span>
<span>  <span class="co"># GO_median_level = GO_median_level[!is.na(GO_median_level$median_level), ]</span></span>
<span>  <span class="va">plot_median</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">GO_median_level</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">median_level</span><span class="op">)</span><span class="op">)</span> </span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">13</span><span class="op">)</span></span>
<span>       <span class="co"># + scale_x_continuous(breaks = 1:18)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2100</span><span class="op">)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{merge_mode}\nNum GO:LRI={nrow(GO)}\nN={nrow(GO_median_level)}"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">plots_median</span><span class="op">[[</span><span class="va">merge_mode</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">plot_median</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="fu">ggplot2.multiplot</span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">plots_max</span>, cols<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s check the median level distributions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2.multiplot</span><span class="op">(</span>plotlist<span class="op">=</span><span class="va">plots_median</span>, cols<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overall-go-term-level-distribution">Overall GO term level distribution<a class="anchor" aria-label="anchor" href="#overall-go-term-level-distribution"></a>
</h2>
<p>We present below the distribution of levels from the GO Terms. This provides a baseline value of what to expect when examining the levels of the relevant GO Terms in other contexts.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GO_LEVEL_NO_OTHER</span> <span class="op">=</span> <span class="va">gene_ontology_level</span><span class="op">[</span><span class="va">ASPECT</span> <span class="op">!=</span> <span class="st">"other"</span><span class="op">]</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">GO_LEVEL_NO_OTHER</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">LEVEL</span><span class="op">)</span><span class="op">)</span> </span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span></span>
<span>       <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"GO Terms level distribution.\nN={nrow(GO_LEVEL_NO_OTHER)}"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We compute the median level for reference.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">GO_LEVEL_NO_OTHER</span><span class="op">$</span><span class="va">LEVEL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-different-merging-modes-on-scdiffcom-toy-object-">Exploring different merging modes on <code>scDiffCom</code> toy object.<a class="anchor" aria-label="anchor" href="#exploring-different-merging-modes-on-scdiffcom-toy-object-"></a>
</h2>
<p>Now we have the LRI GO annotations obtained by the different merging modes. We test them on the toy object available in the package <code><a href="../reference/seurat_sample_tms_liver.html">scDiffCom::seurat_sample_tms_liver</a></code>. First we perform the raw <code>scDiffCom</code> analysis. Then we perform <code>ORA</code> on the results using the different LRI GO annotations and compare the results. Finally, we plot the ORA results from different merging modes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    LRI_species <span class="op">=</span> <span class="st">"mouse"</span>,</span>
<span>    seurat_celltype_id <span class="op">=</span> <span class="st">"cell_type"</span>,</span>
<span>    seurat_condition_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      column_name <span class="op">=</span> <span class="st">"age_group"</span>,</span>
<span>      cond1_name <span class="op">=</span> <span class="st">"YOUNG"</span>,</span>
<span>      cond2_name <span class="op">=</span> <span class="st">"OLD"</span></span>
<span>    <span class="op">)</span>,  </span>
<span>    object_name <span class="op">=</span> <span class="st">"scDiffCom_object"</span>,</span>
<span>    seurat_assay <span class="op">=</span> <span class="st">"RNA"</span>,</span>
<span>    seurat_slot <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>    log_scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    score_type <span class="op">=</span> <span class="st">"geometric_mean"</span>,</span>
<span>    threshold_min_cells <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    threshold_pct <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    threshold_quantile_score <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    threshold_p_value_specificity <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    threshold_p_value_de <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    threshold_logfc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span>,  <span class="co"># log(1.5)</span></span>
<span>    return_distributions <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="va">results</span> <span class="op">=</span> <span class="fu">scDiffCom</span><span class="fu">:::</span><span class="fu">run_internal_raw_analysis</span><span class="op">(</span></span>
<span>  seurat_object <span class="op">=</span> <span class="fu">scDiffCom</span><span class="fu">::</span><span class="va"><a href="../reference/seurat_sample_tms_liver.html">seurat_sample_tms_liver</a></span>,</span>
<span>  LRI_table <span class="op">=</span> <span class="fu">scDiffCom</span><span class="fu">::</span><span class="va"><a href="../reference/LRI_mouse.html">LRI_mouse</a></span><span class="op">$</span><span class="va">LRI_curated</span>,</span>
<span>  LRI_species <span class="op">=</span> <span class="st">"mouse"</span>,</span>
<span>  params <span class="op">=</span> <span class="va">params</span></span>
<span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">=</span> <span class="fu">scDiffCom</span><span class="fu">::</span><span class="fu"><a href="../reference/FilterCCI.html">FilterCCI</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">results_ora</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">LRI_curated_GO_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">GO</span> <span class="op">=</span> <span class="va">LRI_curated_GO_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">merge_mode</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">LRI_curated_GO_list</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">results_ora</span><span class="op">[[</span><span class="va">merge_mode</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">scDiffCom</span><span class="fu">:::</span><span class="fu">run_ora</span><span class="op">(</span></span>
<span>        object <span class="op">=</span> <span class="va">results</span>,</span>
<span>        categories <span class="op">=</span> <span class="st">"GO_TERMS"</span>,</span>
<span>        extra_annotations <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        stringent_or_default <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>        stringent_logfc_threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        class_signature <span class="op">=</span> <span class="st">"scDiffCom"</span>,</span>
<span>        global <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        LRI_curated_GO <span class="op">=</span> <span class="va">GO</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error<span class="op">=</span><span class="kw">function</span> <span class="op">(</span><span class="va">cond</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dt_ora</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">results_ora</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">merge_mode</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">results_ora</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="va">results_ora</span><span class="op">[[</span><span class="va">merge_mode</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">dt</span> <span class="op">=</span> <span class="va">res</span><span class="op">@</span><span class="va">ora_table</span><span class="op">$</span><span class="va">GO_TERMS</span></span>
<span>      <span class="va">dt_m</span> <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>        <span class="va">dt</span>, </span>
<span>        id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VALUE_BIS"</span>, <span class="st">"VALUE"</span>, <span class="st">"CATEGORY"</span>, <span class="st">"LEVEL"</span><span class="op">)</span>, </span>
<span>        measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BH_P_VALUE_UP"</span>, <span class="st">"BH_P_VALUE_DOWN"</span>, <span class="st">"BH_P_VALUE_FLAT"</span><span class="op">)</span>, </span>
<span>        value.name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P_VAL"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">dt_m</span><span class="op">$</span><span class="va">variable</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dt_m</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span></span>
<span>      <span class="va">dt_m</span><span class="op">$</span><span class="va">TYPE</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">dt_m</span><span class="op">$</span><span class="va">variable</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">s</span>, split<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span>
<span>      <span class="va">dt_m</span> <span class="op">=</span> <span class="va">dt_m</span><span class="op">[</span><span class="va">dt_m</span><span class="op">$</span><span class="va">P_VAL</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, <span class="op">]</span></span>
<span>      <span class="va">dt_m</span><span class="op">$</span><span class="va">MERGE_MODE</span> <span class="op">=</span> <span class="va">merge_mode</span></span>
<span>      </span>
<span>      <span class="va">dt_ora</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dt_ora</span>, <span class="va">dt_m</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    error<span class="op">=</span><span class="kw">function</span> <span class="op">(</span><span class="va">cond</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dt_ora</span> <span class="op">=</span> <span class="va">dt_ora</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">LEVEL</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dt_ora</span> <span class="op">=</span> <span class="va">dt_ora</span><span class="op">[</span><span class="va">TYPE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UP"</span>, <span class="st">"DOWN"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">violin_plot</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dt_ora</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">LEVEL</span>, x<span class="op">=</span><span class="va">MERGE_MODE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ancestors_intersection"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"ancestors_intersection\nN={table(dt_ora$MERGE_MODE)['ancestors_intersection']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"intersection"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"intersection\nN={table(dt_ora$MERGE_MODE)['intersection']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"ancestors_union"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"ancestors_union\nN={table(dt_ora$MERGE_MODE)['ancestors_union']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"union"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"union\nN={table(dt_ora$MERGE_MODE)['union']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"ancestors_ligands"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"ancestors_ligands\nN={table(dt_ora$MERGE_MODE)['ancestors_ligands']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"ligands"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"ligands\nN={table(dt_ora$MERGE_MODE)['ligands']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"ancestors_receptors"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"ancestors_receptors\nN={table(dt_ora$MERGE_MODE)['ancestors_receptors']}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"receptors"</span> <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"receptors\nN={table(dt_ora$MERGE_MODE)['receptors']}"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"GO Terms merging modes"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Level"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Distribution of GO Term levels by merging modes."</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, angle<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">violin_plot</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Cyril Lagger, Eugen Ursu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
